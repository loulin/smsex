{"version":3,"sources":["smsex.js"],"names":[],"mappings":"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","file":"smsex.js","sourcesContent":["import Mustache from 'mustache';\nimport _ from 'lodash';\n\nclass SMS {\n  constructor() {\n    this._templates = {};\n    this._providers = null;\n    this._defaultProvider = null;\n  }\n\n  use(name, provider) {\n    if (!provider) {\n      provider = name;\n      name = provider.name;\n    }\n\n    if (!name) {\n      throw new Error('SMS provider must have a name');\n    }\n\n    if (!this._providers) {\n      this._defaultProvider = provider;\n      this._providers = {};\n    }\n\n    this._providers[name] = provider;\n    return this;\n  }\n\n  /**\n   * Set template global or specified provider.\n   *\n   * @method template\n   * @param {Object} templateObj The plain template object, name value pair\n   * or\n   * @param {String} name template name\n   * @param {String} content template content\n   */\n  template(name, content) {\n    if (arguments.length === 0) {\n      return this._templates;\n    }\n\n    let templates;\n    if (_.isObject(name)) {\n      templates = name;\n    } else {\n      if (!content) {\n        return this._templates[name];\n      }\n      templates = {};\n      templates[name] = content;\n    }\n\n    _.assign(this._templates, templates);\n  }\n\n  send(options, callback = () => {}) {\n    if (!this._providers) {\n      throw new Error('No SMS provider');\n    }\n\n    if (_.isString(options) && _.isString(callback)) {\n      options = {\n        to: options,\n        body: callback\n      };\n\n      callback = arguments[2] !== undefined ? arguments[2] : () => {};\n    }\n\n    if (!_.isObject(options)) {\n      throw new Error('options must be object');\n    }\n\n    if (!_.isFunction(callback)) {\n      throw new Error('callback must be function');\n    }\n\n    if (!options.to || !options.body) {\n      throw new Error('send to or message body missing');\n    }\n\n    let provider = options.provider ? this._providers[options.provider] : this._defaultProvider;\n\n    if (_.isString(options.body)) {\n      options.content = options.body;\n    } else if (_.isObject(options.body)) {\n      if (!options.template) {\n        throw new Error('template name missing');\n      }\n\n      let template = provider.templates ? provider.templates[options.template] : null;\n\n      if (!template) {\n        template = this._templates ? this._templates[options.template] : null;\n        if (!template) {\n          throw new Error(`Provider \"${provider.name}\" does not implement or no default \"${options.template}\" template`);\n        }\n      }\n\n      let isInteger = n => !isNaN(parseInt(n)) && isFinite(n) && (n % 1 === 0);\n\n      if (isInteger(template)) {\n        options.template = template;\n      } else {\n        options.content = Mustache.render(template, options.body);\n      }\n    } else {\n      throw new Error('Message body must be string or object');\n    }\n\n    return provider.send(options, callback);\n  }\n}\n\nexport default new SMS();"],"sourceRoot":"/source/"}